# 前言
{: id="20201022163235-ryenyla"}

# 2 An Introduction to Makefiles
{: id="20201022170137-lcacoqe"}

When `make` recompiles the editor, each changed C source file must be recompiled. If a header file has changed, each C source file that includes the header file must be recompiled to be safe.Each compilation produces an object file corresponding to the source file. Finally, if any source file has been recompiled, all the object files, whether newly made or saved from previous compilations, must be linked together to produce the new executable editor.
{: id="20201022165147-mo04goe"}

### 2.1 What a Rule Looks Like
{: id="20201022170211-27wg169"}

A simple makefile consists of “rules” with the following shape:
{: id="20201022170236-942ryzd"}

```
target … : prerequisites …
        recipe
        …
        …
```
{: id="20201022170216-pnrcj5c"}

- A *target* is usually the name of a file that is generated by a program; examples of targets are executable or object files. A target can also be the name of an action to carry out, such as ‘clean’ (see [Phony Targets](https://www.gnu.org/software/make/manual/make.htmlPhony-Targets)).
- A *prerequisite* is a file that is used as input to create the target. A target often depends on several files.
- A *recipe* is an action that `make` carries out. A recipe may have more than one command, either on the same line or each on its own line.（**Note**: you need to put a tab character at the beginning of every recipe line!）
{: id="20201022165119-ijsje2c"}

### 2.2 A Simple Makefile
{: id="20201022170537-klit8ma"}

Here is a straightforward makefile that describes the way an executable file called `edit` depends on eight object files which, in turn, depend on eight C source and three header files.
{: id="20201022170538-ujgt6c4"}

<pre class="example">edit : main.o kbd.o command.o display.o \
       insert.o search.o files.o utils.o
        cc -o edit main.o kbd.o command.o display.o \
                   insert.o search.o files.o utils.o

main.o : main.c defs.h
        cc -c main.c
kbd.o : kbd.c defs.h command.h
        cc -c kbd.c
command.o : command.c defs.h command.h
        cc -c command.c
display.o : display.c defs.h buffer.h
        cc -c display.c
insert.o : insert.c defs.h buffer.h
        cc -c insert.c
search.o : search.c defs.h buffer.h
        cc -c search.c
files.o : files.c defs.h buffer.h command.h
        cc -c files.c
utils.o : utils.c defs.h
        cc -c utils.c
clean :
        rm edit main.o kbd.o command.o display.o \
           insert.o search.o files.o utils.o
</pre>

{: id="20201022172530-pz9pvc7"}

{: id="20201022170047-f5hcgi5"}

{: id="20201022172622-jomgivy"}

# 参考
{: id="20201022163235-9rk6i1i"}

1. [GNU make](https://www.gnu.org/software/make/manual/make.html)
{: id="20201022163238-f2ypc9t"}

{: id="20201022165150-e3kjjz5"}
