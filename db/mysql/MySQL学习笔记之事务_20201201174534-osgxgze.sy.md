# 事务的定义

事务是指一组sql语句组成的数据库逻辑处理单元，在这组的sql操作中，要么全部执行成功，要么全部执行失败。

# 事务的四大特性

### 原子性（Atomicity）

### 一致性（Consistency）

### 隔离性（Isolation）

### 持久性（Durability）

# 事务并发可能产生的问题

### 脏读（dirty read）

脏读指的是读到了没有提交的事务的数据。比如在事务A中，读到事务B修改了但是还未commit的数据。

### 不可重复读（non-repeatable read）

不可重复读指的是在一个事务中，前后两次使用相同的查询语句，会查到不同的结果。比如事务A执行查询语句`select name from user where id = 1`，在事务B中执行`update user set name = 'newValue' where id = 1`，事务A中先后两次执行查询语句得到的值就不一样。

### 幻读（phantom read）

一个事务先根据某些条件查询出一些记录，之后另一个事务又向表中插入（删除）了符合这些条件的记录，原先的事务再次按照该条件查询时，会查询到另一个事务插入（删除）后的记录。在MySQL8版本中，幻读只会在READ UNCOMMITTED和READ COMMITTED这两种隔离级别产生。而之前的版本则是在REPEATABLE READ这种隔离级别也会产生。

# 事务的隔离级别

### 读未提交（READ UNCOMMITTED）

在这种隔离级别下，一个事务可以读到另一事务修改了但是未提交的数据。会产生脏读、幻读、可重复读等问题。

### 读已提交（READ COMMITTED）

在这种隔离级别下，一个事务可以读到另一个事务已提交的数据。解决了脏读的问，但是仍然会产生幻读，可重复读的问题。

### 可重复读（REPEATABLE READ）

这是MySQL默认的隔离级别。在这种隔离级别下，在一个事务A中执行同样的select语句，返回结果是不变的。那怕此时开启另一个事务B对事务A查询的表数据进行了修改，并提交，仍然不会影响到事务A查询的结果。

### 可串行化（SERIALIZABLE）

串行化是4种事务隔离级别中隔离效果最好的，解决了脏读、可重复读、幻读的问题，但是效果最差，它将事务的执行变为顺序执行，与其他三个隔离级别相比，它就相当于单线程，后一个事务的执行必须等待前一个事务结束。

在这种隔离级别下，同时开启（begin）两个事务（A和B），可以在两个事务中同时执行SELECT语句，但是当其中一个事务A执行了INSERT、UPDATE、DELETE语句时，需要另一个事务B执行commit之后才能进行下去；当事务A开启事务（begin）并修改（INSERT、UPDATE、DELETE）了表的内容，必须执行完commit语句，另一个事务B才能使用SELECT查询。

# 事务的相关操作

1. 开启事务：`begin;` 或者 `start transaction;`
2. 回滚：`rollback;`
3. 提交事务：`commit;`
4. 开启（禁用）默认提交事务：`SET autocommit = {0 | 1}`
5. 查看当前隔离级别：`select @@transaction_isolation;`
6. 设置隔离级别：`set {session | global } transaction isolation level {read uncommitted | read committed | repeatable read | serializable};`

# 具体例子

### 创建一个表use

```
 CREATE TABLE `user` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(20) DEFAULT NULL,
   PRIMARY KEY (`id`)
) 
```
